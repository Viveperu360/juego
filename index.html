<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Catedral de Lima: Historia viva en el corazón de la ciudad</title>
    
    <!-- Google Fonts: Playfair Display for titles, Lato for text -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <!-- Simple library for scroll animations -->
    <script src="https://unpkg.com/scrollreveal"></script>
    
    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    

    <style>
        /* --- CSS VARIABLES AND GLOBAL STYLES (NEW ELEGANT PALETTE) --- */
        :root {
            --color-primary: #C09A50; /* Refined Gold/Bronze */
            --color-primary-light: #E6C582; /* Lighter shade for gradient */
            --color-background-light: #F4F4F4; /* Light Neutral Gray */
            --color-background-dark: #2C3E50; /* Dark Slate Blue */
            --color-text-dark: #34495E; /* Darker Slate for text on light bg */
            --color-text-light: #ECF0F1; /* Light Gray for dark bg */
            --color-white: #FFFFFF;
            --font-title: 'Playfair Display', serif;
            --font-text: 'Lato', sans-serif;
            --header-height: 90px; /* Increased header height */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-text);
            background-color: var(--color-background-dark);
            color: var(--color-text-light);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-top: var(--header-height); /* Prevent content from hiding behind fixed header */
        }

        h1, h2 {
            font-family: var(--font-title);
            font-weight: 700;
        }
        
        /* --- HEADER / NAVIGATION BAR --- */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--header-height);
            background-color: var(--color-background-dark);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            transition: height 0.4s cubic-bezier(0.19, 1, 0.22, 1), box-shadow 0.3s ease;
        }

        .main-header.scrolled {
             height: 70px; /* Shrink header on scroll */
             box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .header-left, .header-right {
            flex: 1;
        }
        .header-right {
            display: flex;
            justify-content: flex-end;
        }

        .header-left a {
            font-family: var(--font-title);
            font-size: 1.5rem;
            color: var(--color-white);
            text-decoration: none;
            font-weight: 700;
        }

        .main-nav ul {
            list-style: none;
            display: flex;
            gap: 30px;
        }

        .main-nav a {
            color: var(--color-text-light);
            text-decoration: none;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 5px 0;
            position: relative;
            transition: color 0.3s ease;
        }

        .main-nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--color-primary);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .main-nav a:hover {
            color: var(--color-primary);
        }
        
        .main-nav a:hover::after {
            transform: scaleX(1);
        }
        
        /* --- DYNAMIC CENTER LOGO --- */
        .header-center-logo {
            position: absolute;
            left: 50%;
            top: 20px;
            transform: translateX(-50%);
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 1001;
        }
        
        .header-center-logo img {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .main-header.scrolled .header-center-logo {
            top: 5px; /* Sits inside the 70px scrolled header */
        }

        .main-header.scrolled .header-center-logo img {
            width: 60px;
            height: 60px;
            box-shadow: none;
        }


        /* --- GRADIENT TEXT STYLE --- */
        .gradient-text {
            background: linear-gradient(45deg, var(--color-primary), var(--color-primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        section {
            padding: 100px 10%;
            overflow-x: hidden;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #inicio {
            border-bottom: none;
        }
        
        #guia-multimedia, #galeria, #detalles, #ubicacion {
            background-color: var(--color-background-light);
            color: var(--color-text-dark);
            border-bottom-color: rgba(0,0,0,0.1);
        }
        
        #guia-multimedia h2, #galeria h2, #detalles h2, #ubicacion h2 {
            color: var(--color-text-dark);
        }

        #guia-multimedia .section-title::after, #galeria .section-title::after, #detalles .section-title::after, #ubicacion .section-title::after {
            background-color: var(--color-text-dark);
        }
        
        .section-title {
            text-align: center;
            font-size: clamp(2.5rem, 5vw, 3rem);
            margin-bottom: 60px;
            position: relative;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background-color: var(--color-primary);
            margin: 15px auto 0;
        }
        
        .section-description {
            max-width: 700px;
            margin: -40px auto 40px auto;
            font-size: 1.1rem;
            line-height: 1.6;
            color: #6c757d;
            text-align: center;
        }
        #historia .section-description, #modelo-3d .section-description {
            color: var(--color-text-light);
            opacity: 0.8;
        }


        /* --- 1. HERO SECTION (IMPROVED) --- */
        #inicio {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: calc(100vh - var(--header-height));
            padding: 20px;
            color: var(--color-white);
            background-image: linear-gradient(rgba(10, 25, 47, 0.5), rgba(10, 25, 47, 0.8)), url('fondo.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            overflow: hidden;
        }

        #inicio .hero-content {
             z-index: 1;
        }

        #inicio h1 {
            font-size: clamp(4rem, 10vw, 7rem);
            color: var(--color-white);
            text-shadow: 0px 5px 25px rgba(0,0,0,0.9);
            line-height: 1.1;
            margin: 0;
            animation: fadeIn 2s ease-out;
        }

        #inicio .subtitle {
            font-family: var(--font-text);
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--color-white);
            margin-top: 15px;
            text-shadow: 0px 3px 15px rgba(0,0,0,0.9);
            animation: slideIn 1.5s 0.5s ease-out forwards;
            opacity: 0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
             from {
                 opacity: 0;
                 transform: translateX(-50px);
            }
            to {
                 opacity: 1;
                 transform: translateX(0);
            }
        }

        .explore-button {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 25px;
            text-decoration: none;
            color: var(--color-white);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: background 0.3s, transform 0.3s;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .explore-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-50%) translateY(-5px);
        }

        .explore-button .arrow {
            width: 10px;
            height: 10px;
            border-bottom: 2px solid var(--color-white);
            border-right: 2px solid var(--color-white);
            transform: rotate(45deg);
            animation: arrow-pulse 2s infinite;
        }

        @keyframes arrow-pulse {
            0% { transform: translateY(0) rotate(45deg); opacity: 1; }
            50% { transform: translateY(5px) rotate(45deg); opacity: 0.5; }
            100% { transform: translateY(0) rotate(45deg); opacity: 1; }
        }


        /* --- 2. INTERACTIVE VISUAL GALLERY --- */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            position: relative;
            cursor: pointer;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            height: 350px;
            transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .gallery-item:active {
            transform: scale(0.95);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-item .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, transparent 100%);
            color: var(--color-white);
            padding: 50px 20px 20px;
            opacity: 1;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: flex-end;
        }
        
        .gallery-item .overlay-text {
            transform: translateY(10px);
            opacity: 0;
            transition: transform 0.4s ease, opacity 0.4s ease;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .gallery-item:hover .overlay-text {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* --- MODALS (for Media and Gemini) --- */
        .modal {
            visibility: hidden;
            opacity: 0;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(33, 33, 33, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), visibility 0.4s;
            padding: 20px;
        }
        .modal.visible {
            visibility: visible;
            opacity: 1;
        }
        
        .gemini-modal-content,
        .modal-content-inner {
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative; /* Context for the close button */
        }

        .modal.visible .gemini-modal-content,
        .modal.visible .modal-content-inner {
            transform: scale(1);
            opacity: 1;
        }

        .modal-content-inner {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #media-container video, 
        #media-container img {
            width: auto;
            max-width: 90vw;
            max-height: 80vh;
            display: block;
            border-radius: 8px;
        }
        
        .modal-caption {
            margin: 15px auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            font-size: 1.1rem;
            padding: 10px 0;
        }
        
        .gemini-modal-content {
            background-color: var(--color-background-light);
            padding: 40px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .gemini-modal-content h3 {
            margin-bottom: 20px;
            font-size: 2rem;
            color: var(--color-text-dark);
        }
        .gemini-modal-content p {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--color-text-dark);
            min-height: 100px;
        }

        .close-media-modal,
        .close-gemini-modal {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #aaa;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            line-height: 1;
            z-index: 10;
        }

        .close-media-modal {
            color: #fff;
            top: -10px;
            right: 0px;
            font-size: 48px;
            text-shadow: 0px 2px 5px rgba(0,0,0,0.5);
        }
        .close-media-modal:hover { color: #ccc; }
        .close-gemini-modal:hover,
        .close-gemini-modal:focus {
            color: var(--color-text-dark);
        }
        
        /* --- LOADER --- */
        .loader {
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid var(--color-primary);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- 3. VISUAL TIMELINE --- */
        #historia .section-title {
             color: var(--color-primary);
        }

        .timeline {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
        }

        .timeline::after {
            content: '';
            position: absolute;
            width: 4px;
            background-color: var(--color-primary);
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -2px;
        }

        .timeline-container {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
            width: 50%;
        }
        
        .timeline-container.left { left: 0; }
        .timeline-container.right { left: 50%; }

        .timeline-container::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            right: -12px;
            background-color: var(--color-background-light);
            border: 4px solid var(--color-primary);
            top: 35px;
            border-radius: 50%;
            z-index: 1;
        }

        .right::after { left: -8px; }

        .timeline-content {
            padding: 25px;
            background-color: rgba(255, 255, 255, 0.05);
            position: relative;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .timeline-content video { /* UPDATED from img */
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 15px;
            cursor: pointer;
            background-color: #000;
        }
        
        .timeline-content h3 { font-size: 1.8rem; margin-bottom: 10px; color: var(--color-text-light);}
        .timeline-content p { font-size: 0.95rem; line-height: 1.6; font-weight: 300; }

        /* --- 4. ARCHITECTURAL DETAILS --- */
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
        }

        .detail-item {
            text-align: center;
        }
        
        .detail-image-container {
            overflow: hidden;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .detail-item img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            display: block;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .detail-item:hover img {
            transform: scale(1.15);
        }
        
        .detail-item h3 {
            font-size: 1.6rem;
            color: var(--color-text-dark);
            margin-bottom: 5px;
            font-family: var(--font-title);
        }
        
        .detail-item p {
            font-size: 1rem;
            color: var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        /* --- BUTTONS --- */
        .gemini-button, .media-button, .cta-button, #generate-poem-btn {
            background: linear-gradient(45deg, var(--color-primary), var(--color-primary-light));
            color: var(--color-white);
            border: none;
            padding: 12px 24px;
            font-family: var(--font-text);
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-size: 1rem;
            background-size: 150% 150%;
        }
        .gemini-button:hover, .media-button:hover, .cta-button:hover, #generate-poem-btn:hover {
            transform: translateY(-3px);
            background-position: right center;
        }
        
        /* --- 5. 3D MODEL SECTION --- */
        #modelo-3d .section-title, #modelo-3d .section-description {
            color: var(--color-text-light);
        }
        #modelo-3d .section-title::after {
             background-color: var(--color-primary);
        }
        #three-canvas-container {
            width: 100%;
            height: 70vh;
            min-height: 500px;
            margin-top: 40px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background-color: #333;
        }
        #three-canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }

        /* --- 6. MULTIMEDIA GUIDE SECTION --- */
        #guia-multimedia h2 {
             color: var(--color-text-dark);
        }
         #guia-multimedia .section-title::after {
             background-color: var(--color-text-dark);
        }
        
        .media-controls, .language-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .language-options {
            visibility: hidden;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .language-options.visible {
            visibility: visible;
            opacity: 1;
            max-height: 100px; /* Adjust as needed */
            margin-top: 30px;
        }
        
        .media-content-placeholder {
            visibility: hidden;
            opacity: 0;
            transform: translateY(20px);
            max-height: 0;
            overflow: hidden;
            width: 100%;
            max-width: 800px;
            margin: 40px auto 0;
            padding: 0 20px;
            background-color: var(--color-white);
            border: 1px solid #dee2e6;
            border-radius: 12px;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .media-content-placeholder.visible {
             visibility: visible;
            opacity: 1;
            transform: translateY(0);
            max-height: 500px; /* Adjust as needed */
            padding: 20px;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: 8px;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* --- 7. MAP AND LOCATION --- */
        .map-container {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            align-items: center;
        }

        .map-text {
            flex: 1 1 400px;
        }
        
        .map-text h2 {
            font-size: clamp(2.2rem, 5vw, 2.8rem);
            text-align: left;
            color: var(--color-text-dark);
        }
        .map-text h2::after {
            margin: 15px 0 0;
             background-color: var(--color-text-dark);
        }

        .map-text img {
            width: 100%;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .map-embed {
            flex: 1 1 500px;
            height: 480px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .map-embed iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
        
        /* --- 8. FOOTER --- */
        footer {
            background-color: var(--color-background-dark);
            color: var(--color-text-light);
            text-align: center;
            padding: 50px 10%;
        }
        
        .footer-logo {
            width: 180px;
            height: auto;
            margin-bottom: 25px;
            opacity: 0.9;
        }
        
        .social-links {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 40px;
        }
        .social-link-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .social-link-item a {
            color: var(--color-text-light);
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .social-link-item a:hover {
            color: var(--color-primary);
            transform: translateY(-3px);
        }
        .social-link-item svg {
            width: 28px;
            height: 28px;
            fill: currentColor;
        }
        .social-link-item span {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--color-text-light);
            opacity: 0.7;
        }
        
        .footer-credits {
            margin-top: 25px;
            font-size: 0.85rem;
            opacity: 0.6;
            line-height: 1.6;
        }

        /* --- 9. POEM WIDGET (NEW) --- */
        #poem-widget-container {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 1002;
        }

        .poem-trigger-button {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--color-primary), var(--color-primary-light));
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            padding: 12px;
        }
        .poem-trigger-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .poem-trigger-button img { 
            width: 100%;
            height: 100%;
            transition: transform 0.4s ease;
            filter: brightness(0) invert(1);
        }
        #poem-content.open + .poem-trigger-button img { 
            transform: rotate(135deg);
        }


        .poem-content {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            background-color: var(--color-background-light);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: var(--color-text-dark);
            padding: 20px;
            visibility: hidden;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .poem-content.open {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }

        .poem-content h3 {
            font-family: var(--font-title);
            color: var(--color-text-dark);
            margin-bottom: 15px;
            text-align: center;
        }

        .poem-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 15px;
            font-family: var(--font-text);
            font-size: 1rem;
        }
        
        #generate-poem-btn {
            width: 100%;
        }

        #poem-result-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            min-height: 120px;
            font-style: italic;
            line-height: 1.6;
            white-space: pre-wrap; /* To respect line breaks in poem */
        }
        
        /* --- RESPONSIVE DESIGN ADJUSTMENTS --- */
        @media (max-width: 768px) {
            .main-nav, #historical-clock {
                 display: none;
            }
            .header-left a {
                 display: none;
            }
            section { padding: 80px 5%; }
            .timeline::after { left: 31px; }
            .timeline-container { width: 100%; padding-left: 70px; padding-right: 25px; }
            .timeline-container.left, .timeline-container.right { left: 0%; }
            .timeline-container.left::after, .timeline-container.right::after { left: 21px; }

            #poem-widget-container {
                bottom: 15px;
                right: 15px;
            }
            .poem-content {
                width: calc(100vw - 30px);
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-left">
            <a href="#inicio">Vive Peru 360</a>
        </div>
        <div class="header-center-logo">
            <img src="nueva.png" alt="Logo Dinámico" onerror="this.onerror=null;this.src='https://placehold.co/130x130/2C3E50/FFFFFF?text=Logo';">
        </div>
        <div class="header-right">
            <nav class="main-nav">
                <ul>
                    <li><a href="#galeria">Galería</a></li>
                    <li><a href="#historia">Historia</a></li>
                    <li><a href="#detalles">Tesoros</a></li>
                    <li><a href="#ubicacion">Ubicación</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="inicio">
        <div class="hero-content">
            <h1>La Catedral de Lima</h1>
            <p class="subtitle">Una historia viva en el corazón de la ciudad</p>
        </div>
        <a href="#galeria" class="explore-button">
            <span>Descubre más</span>
            <div class="arrow"></div>
        </a>
    </section>

    <section id="galeria">
        <h2 class="section-title">Galería Visual</h2>
        <div class="gallery-grid">
             <div class="gallery-item" data-img-src="fachada.jpg" data-caption="La fachada de la Catedral de Lima combina elementos renacentistas con torres neoclásicas simétricas, destacando por su sobriedad, armonía y monumentalidad frente a la Plaza Mayor.">
                 <img src="fachada.jpg" alt="Fachada de la Catedral" onerror="this.onerror=null;this.src='https://placehold.co/300x350/cccccc/000000?text=Fachada';">
                 <div class="overlay"><span class="overlay-text">Fachada Principal</span></div>
            </div>
             <div class="gallery-item" data-img-src="cate interior.jpg" data-caption="El interior de la catedral deslumbra con una combinación de estilo barroco y neoclásico, reflejada en sus amplias naves, columnas altas y decoración solemne.">
                 <img src="cate interior.jpg" alt="Nave Central" onerror="this.onerror=null;this.src='https://placehold.co/300x350/cccccc/000000?text=Nave+Central';">
                 <div class="overlay"><span class="overlay-text">Vista interior</span></div>
            </div>
             <div class="gallery-item" data-img-src="retablo.jpg" data-caption="Los retablos dorados de estilo barroco contrastan con las bóvedas elevadas y luminosas, creando un ambiente sagrado y monumental.">
                 <img src="retablo.jpg" alt="Retablos y Bóvedas" onerror="this.onerror=null;this.src='https://placehold.co/300x350/cccccc/000000?text=Retablos';">
                 <div class="overlay"><span class="overlay-text">Retablos y Bóvedas</span></div>
            </div>
             <div class="gallery-item" data-img-src="cripta de pizarro.jpg" data-caption="La cripta de Francisco Pizarro, ubicada en el interior de la catedral, conserva sus restos en un espacio solemne decorado con mosaicos e inscripciones históricas.">
                 <img src="Cripta de pizarro.jpg" alt="Cripta de Pizarro" onerror="this.onerror=null;this.src='https://placehold.co/300x350/cccccc/000000?text=Cripta';">
                 <div class="overlay"><span class="overlay-text">Cripta de Pizarro</span></div>
            </div>
             <div class="gallery-item" data-img-src="vista nocturna.jpg" data-caption="Iluminada por luces cálidas, la Catedral de Lima adquiere por la noche un aspecto majestuoso y sereno que resalta su imponente arquitectura en el corazón del centro histórico.">
                 <img src="vista nocturna.jpg" alt="Vista Nocturna" onerror="this.onerror=null;this.src='https://placehold.co/300x350/cccccc/000000?text=Vista+Nocturna';">
                 <div class="overlay"><span class="overlay-text">Vista Nocturna</span></div>
            </div>
        </div>
    </section>

    <div id="mediaModal" class="modal">
        <div class="modal-content-inner">
            <span class="close close-media-modal">&times;</span>
            <div id="media-container"></div>
            <div id="mediaCaption" class="modal-caption"></div>
        </div>
    </div>

    <div id="geminiModal" class="modal">
        <div class="gemini-modal-content">
            <span class="close close-gemini-modal">&times;</span>
            <h3 id="geminiModalTitle"></h3>
            <div id="geminiModalResult"><div class="loader"></div></div>
        </div>
    </div>

    <section id="historia">
        <h2 class="section-title">Vive la historia</h2>
        <div class="timeline">
            <div class="timeline-container left">
                <div class="timeline-content">
                    <video class="timeline-video" loop muted playsinline src="inicio.mp4"></video>
                    <h3>1535</h3>
                    <p>Francisco Pizarro coloca la primera piedra, iniciando la construcción de la primera iglesia mayor en la recién fundada Ciudad de los Reyes.</p>
                </div>
            </div>
            <div class="timeline-container right">
                <div class="timeline-content">
                    <video class="timeline-video" loop muted playsinline src="Terremoto_en_Lima_siglo_XVIII.mp4" poster="https://placehold.co/400x180/2c3e50/ffffff?text=Video+1746"></video>
                    <h3>1746</h3>
                    <p>Un devastador terremoto destruye gran parte de la catedral. Su reconstrucción, liderada por el jesuita Juan Rehr, definirá su apariencia actual.</p>
                </div>
            </div>
            <div class="timeline-container left">
                <div class="timeline-content">
                     <video class="timeline-video" loop muted playsinline src="Video_de_Catedral_de_Lima.mp4" poster="https://placehold.co/400x180/2c3e50/ffffff?text=Video+1797"></video>
                    <h3>1797</h3>
                    <p>Se concluyen las torres neoclásicas, diseñadas por Ignacio Martorell, que coronan la fachada con su característico estilo hasta el día de hoy.</p>
                </div>
            </div>
              <div class="timeline-container right">
                <div class="timeline-content">
                     <video class="timeline-video" loop muted playsinline src="Pizarro_s_Tomb_Discovery_Video.mp4" poster="https://placehold.co/400x180/2c3e50/ffffff?text=Video+1977"></video>
                    <h3>1977</h3>
                    <p>Científicos confirman la autenticidad de los restos de Francisco Pizarro, hallados en una cripta, consolidando un capítulo clave de su historia.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="detalles">
        <h2 class="section-title">Tesoros Arquitectónicos</h2>
        <div class="details-grid">
            <div class="detail-item">
                <div class="detail-image-container">
                    <img src="altar nuevo.JPG" alt="Altar Mayor" onerror="this.onerror=null;this.src='https://placehold.co/320x400/cccccc/000000?text=Altar+Mayor';">
                </div>
                <h3>El Altar Mayor</h3>
                <p>Siglo XVIII | Neoclásico</p>
                <button class="gemini-button" data-item-name="El Altar Mayor">✨ Describir con IA</button>
            </div>
            <div class="detail-item">
                <div class="detail-image-container">
                    <img src="silleria.jpg" alt="Sillería del Coro" onerror="this.onerror=null;this.src='https://placehold.co/320x400/cccccc/000000?text=Sillería+del+Coro';">
                </div>
                <h3>Sillería del Coro</h3>
                <p>Siglo XVII | Barroco</p>
                <button class="gemini-button" data-item-name="La Sillería del Coro">✨ Describir con IA</button>
            </div>
            <div class="detail-item">
                <div class="detail-image-container">
                    <img src="puerta.jpg" alt="Puerta del Perdón" onerror="this.onerror=null;this.src='https://placehold.co/320x400/cccccc/000000?text=Puerta+del+Perdón';">
                </div>
                <h3>Puerta del Perdón</h3>
                <p>Siglo XVII | Renacimiento</p>
                <button class="gemini-button" data-item-name="La Puerta del Perdón">✨ Describir con IA</button>
            </div>
        </div>
    </section>
    
    <section id="modelo-3d">
        <h2 class="section-title">Explora el Modelo 3D (beta)</h2>
        <p class="section-description">
            Usa tu ratón o tus dedos para rotar, arrastrar y hacer zoom. Descubre una representación artística de la Catedral de Lima.
        </p>
        <div id="three-canvas-container">
            <canvas id="three-canvas"></canvas>
        </div>
    </section>

    <section id="guia-multimedia">
        <h2 class="section-title">Guía Multimedia</h2>
        <p class="section-description">
            Selecciona el formato y el idioma para comenzar tu recorrido virtual por la historia y los secretos de la Catedral de Lima.
        </p>
        <div class="media-controls">
            <button class="media-button" id="btn-video">Ver Video</button>
            <button class="media-button" id="btn-audio">Escuchar Audio</button>
        </div>
        <div class="language-options" id="video-lang-options">
            <button class="media-button" data-type="video" data-lang="es">Español</button>
            <button class="media-button" data-type="video" data-lang="en">Inglés</button>
        </div>
        <div class="language-options" id="audio-lang-options">
            <button class="media-button" data-type="audio" data-lang="es">Español</button>
            <button class="media-button" data-type="audio" data-lang="en">Inglés</button>
        </div>

        <div class="media-content-placeholder" id="video-placeholder"></div>
        <div class="media-content-placeholder" id="audio-placeholder"></div>
    </section>


    <section id="ubicacion">
        <div class="map-container">
            <div class="map-text">
                <h2 class="section-title">En el Corazón de Lima</h2>
                <img src="vista aerea.jpg" alt="Vista aérea de la Plaza Mayor" onerror="this.onerror=null;this.src='https://placehold.co/400x250/cccccc/000000?text=Plaza+Mayor';">
                <p style="margin-bottom: 30px; line-height: 1.7; font-size: 1.1rem;">La Basílica Catedral Metropolitana de Lima y Primada del Perú se ubica en el lado este de la Plaza Mayor, el epicentro histórico y cultural de la capital peruana.</p>
                <a href="https://www.google.com/maps/dir//Catedral+de+Lima,+Jir%C3%B3n+Carabaya,+Lima+15001" target="_blank" class="cta-button">
                    ¿CÓMO LLEGAR?
                </a>
            </div>
            <div class="map-embed">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3901.93099951163!2d-77.0325983258908!3d-12.045625941687612!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9105c8b5d357a79b%3A0x6b12a8f889a72183!2sCatedral%20de%20Lima!5e0!3m2!1ses!2spe!4v1678897042517!5m2!1ses!2spe" 
                allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>
    </section>

    <footer>
        <img src="https://cdn.teleticket.com.pe/especiales/activandocultura/images/logos-ministerio-de-cultura.png" alt="Logo Ministerio de Cultura" class="footer-logo" onerror="this.onerror=null;this.src='https://placehold.co/180x50/2C3E50/FFFFFF?text=Logo+Ministerio';">
        <div class="social-links">
            <div class="social-link-item">
                <a href="https://www.facebook.com/minculturape" target="_blank" rel="noopener noreferrer" title="Facebook">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.891h-2.33V21.878A10.001 10.001 0 0 0 22 12z"></path></svg>
                </a>
                <span>Facebook</span>
            </div>
            <div class="social-link-item">
                <a href="https://www.instagram.com/minculturape" target="_blank" rel="noopener noreferrer" title="Instagram">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.012 3.584-.07 4.85c-.148 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.85-.07-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.012-3.584.07-4.85c.148-3.225 1.664-4.771 4.919-4.919 1.266-.057 1.644-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zM12 16c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"></path></svg>
                </a>
                <span>Instagram</span>
            </div>
            <div class="social-link-item">
                <a href="#modelo-3d" title="Visita Virtual">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-2.42 1.18-4.57 3-5.96v11.92c-1.82-1.39-3-3.54-3-5.96zm2.02 7.02c.81.63 1.76 1.14 2.8 1.45V4.53c-1.04.31-1.99.82-2.8 1.45l-.02 14.04zm7.96 1.45c1.04-.31 1.99-.82 2.8-1.45V5.98c-.81-.63-1.76-1.14-2.8-1.45v14.94zM17 17.96v-11.92c1.82 1.39 3 3.54 3 5.96s-1.18 4.57-3 5.96z"></path></svg>
                </a>
                <span>Visita Virtual</span>
            </div>
        </div>
        <p class="footer-credits">
            Página web diseñada y desarrollada por Vive Peru 360.<br>
            Las imágenes utilizadas son propiedad de sus respectivos autores y se utilizan con fines ilustrativos. <br>
            Todos los derechos reservados © 2025.
        </p>
    </footer>

    <!-- POEM WIDGET (NEW) -->
    <div id="poem-widget-container">
        <div class="poem-content" id="poem-content">
            <h3>Pide un Deseo Poético</h3>
            <input type="text" id="poem-keyword-input" class="poem-input" placeholder="Escribe una palabra (ej: fe, historia...)">
            <button id="generate-poem-btn">✨ Generar Poema</button>
            <div id="poem-result-container">
                <p>Aquí nacerá la poesía...</p>
            </div>
        </div>
        <button class="poem-trigger-button" id="poem-trigger-btn" title="Pide un Deseo">
             <img src="https://images.icon-icons.com/2070/PNG/512/feather_icon_125683.png" alt="Pide un Deseo">
        </button>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Header Scroll Effect ---
            const header = document.querySelector('.main-header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });

            // --- General Modal Handling ---
            const mediaModal = document.getElementById('mediaModal');
            const geminiModal = document.getElementById('geminiModal');
            
            function openModal(modal) {
                modal.classList.add('visible');
            }

            function closeModal(modal) {
                modal.classList.remove('visible');
                const mediaContainer = document.getElementById('media-container');
                if (mediaContainer) {
                    mediaContainer.innerHTML = ''; // Stop video playback when closing
                }
            }

            // --- Media Modal (for Gallery Images and Timeline Videos) ---
            const mediaContainer = document.getElementById('media-container');
            const mediaCaption = document.getElementById('mediaCaption');

            document.querySelectorAll('.gallery-item').forEach(item => {
                item.addEventListener('click', function() {
                    mediaContainer.innerHTML = ''; // Clear previous content

                    const img = document.createElement('img');
                    img.src = this.dataset.imgSrc || this.querySelector('img').src;
                    img.alt = this.dataset.caption;
                    mediaContainer.appendChild(img);
                    
                    mediaCaption.innerText = this.dataset.caption;
                    openModal(mediaModal);
                });
            });

            document.querySelectorAll('.timeline-video').forEach(video => {
                video.addEventListener('click', function() {
                    mediaContainer.innerHTML = '';

                    const videoClone = document.createElement('video');
                    videoClone.src = this.src;
                    videoClone.controls = true;
                    videoClone.autoplay = true;
                    videoClone.loop = true;
                    mediaContainer.appendChild(videoClone);

                    const content = this.closest('.timeline-content');
                    const year = content.querySelector('h3').innerText;
                    const desc = content.querySelector('p').innerText;
                    mediaCaption.innerText = `${year}: ${desc}`;
                    
                    openModal(mediaModal);
                });
            });


            document.querySelector('.close-media-modal').onclick = () => closeModal(mediaModal);

            // --- Gemini Modal Logic ---
            const geminiModalTitle = document.getElementById('geminiModalTitle');
            const geminiModalResult = document.getElementById('geminiModalResult');
            document.querySelectorAll('.gemini-button[data-item-name]').forEach(button => {
                button.addEventListener('click', function() {
                    const itemName = this.dataset.itemName;
                    geminiModalTitle.innerText = itemName;
                    geminiModalResult.innerHTML = '<div class="loader"></div>';
                    openModal(geminiModal);
                    const prompt = `Actúa como un historiador de arte apasionado. Describe en un párrafo corto (máximo 100 palabras) la pieza llamada '${itemName}' que se encuentra en la Catedral de Lima, Perú. Usa un lenguaje poético y evocador que inspire al lector a querer verla.`;
                    callGemini(prompt, geminiModalResult);
                });
            });
            document.querySelector('.close-gemini-modal').onclick = () => closeModal(geminiModal);

            // --- Poem Widget Logic (NEW) ---
            const poemWidget = document.getElementById('poem-content');
            const poemTriggerBtn = document.getElementById('poem-trigger-btn');
            const generatePoemBtn = document.getElementById('generate-poem-btn');
            const poemInput = document.getElementById('poem-keyword-input');
            const poemResultContainer = document.getElementById('poem-result-container');

            poemTriggerBtn.addEventListener('click', () => {
                poemWidget.classList.toggle('open');
            });

            generatePoemBtn.addEventListener('click', () => {
                const keyword = poemInput.value.trim();
                if (keyword === "") {
                    poemResultContainer.innerHTML = "<p>Por favor, escribe una palabra para inspirar al bardo.</p>";
                    return;
                }
                const prompt = `Actúa como un bardo inspirado por la majestuosidad de la Catedral de Lima. Escribe un poema corto y evocador (4 a 6 versos) sobre el concepto de "${keyword}". El poema debe reflejar la atmósfera de historia, fe y arte del lugar.`;
                poemResultContainer.innerHTML = '<div class="loader"></div>';
                callGemini(prompt, poemResultContainer);
            });


            // --- Timeline Video Hover Logic ---
            document.querySelectorAll('.timeline-video').forEach(video => {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            video.play().catch(e => { /* Ignore autoplay errors */ });
                        } else {
                            video.pause();
                        }
                    });
                }, { threshold: 0.5 }); 

                observer.observe(video);
            });

            // Close modals on outside click
            window.onclick = function(event) {
                if (event.target == mediaModal) closeModal(mediaModal);
                if (event.target == geminiModal) closeModal(geminiModal);
            }
            
            // --- Reusable Gemini API Fetch Function ---
            async function callGemini(prompt, resultElement) {
                const apiKey = "AIzaSyD5Sj3ypZWlrRg5rPxQl4gbmzUIVRFvMJo"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }]
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json(); 

                    if (!response.ok) {
                        console.error("API Error Response:", result);
                        let errorMsg = `Error: ${response.statusText}.`;
                        if (result.error && result.error.message) {
                            errorMsg += `<br><small>${result.error.message}</small>`;
                        }
                        throw new Error(errorMsg);
                    }
                    
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        resultElement.innerHTML = `<p>${text.replace(/\n/g, '<br>')}</p>`;
                    } else {
                        console.error("Invalid response or blocked by API.", result);
                        let errorMessage = "La respuesta de la IA no pudo ser procesada.";
                        if(result.promptFeedback && result.promptFeedback.blockReason){
                           errorMessage += ` Razón: ${result.promptFeedback.blockReason}`;
                        }
                        resultElement.innerHTML = `<p style="color: #e74c3c;">${errorMessage}</p>`;
                    }

                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    let finalErrorMsg = `<p style="color: #c0392b;">Lo sentimos, ocurrió un error de conexión con el servicio de IA.<br><small>Detalle: ${error.message}</small></p>`;
                    if (error.message.includes('Failed to fetch')) {
                        finalErrorMsg += `<p style="font-size: 0.8rem; margin-top: 10px; color: #34495E;"><b>Nota:</b> Si estás ejecutando este archivo localmente, este error puede ser causado por las políticas de seguridad del navegador (CORS). Intenta usar una extensión como "Live Server" en tu editor de código para solucionarlo.</p>`;
                    }
                    resultElement.innerHTML = finalErrorMsg;
                }
            }


            // --- Multimedia Guide Logic ---
            const btnVideo = document.getElementById('btn-video');
            const btnAudio = document.getElementById('btn-audio');
            const videoLangOptions = document.getElementById('video-lang-options');
            const audioLangOptions = document.getElementById('audio-lang-options');
            const videoPlaceholder = document.getElementById('video-placeholder');
            const audioPlaceholder = document.getElementById('audio-placeholder');

            function hideAllMedia() {
                videoLangOptions.classList.remove('visible');
                audioLangOptions.classList.remove('visible');
                videoPlaceholder.classList.remove('visible');
                audioPlaceholder.classList.remove('visible');
                videoPlaceholder.innerHTML = "";
                audioPlaceholder.innerHTML = "";
            }

            btnVideo.addEventListener('click', () => {
                const wasVisible = videoLangOptions.classList.contains('visible');
                hideAllMedia();
                if (!wasVisible) videoLangOptions.classList.add('visible');
            });

            btnAudio.addEventListener('click', () => {
                const wasVisible = audioLangOptions.classList.contains('visible');
                hideAllMedia();
                if(!wasVisible) audioLangOptions.classList.add('visible');
            });

            document.querySelectorAll('.language-options button').forEach(button => {
                button.addEventListener('click', function() {
                    const type = this.dataset.type;
                    const lang = this.dataset.lang;
                    
                    if (type === 'video') {
                        videoLangOptions.classList.remove('visible');
                        videoPlaceholder.classList.add('visible');
                        if (lang === 'es') {
                            videoPlaceholder.innerHTML = `
                                <p style="text-align:center; margin-bottom:15px; font-size:1.1rem; font-weight:bold;">Video en Español</p>
                                <div class="video-container">
                                    <iframe 
                                        src="https://www.youtube.com/embed/O20A8RWWC1k" 
                                        title="YouTube video player" 
                                        frameborder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                        allowfullscreen>
                                    </iframe>
                                </div>
                            `;
                        } else {
                             videoPlaceholder.innerHTML = `
                                <p style="text-align:center; margin-bottom:15px; font-size:1.1rem; font-weight:bold;">Video en Inglés (Placeholder)</p>
                                <div class="video-container" style="background-color: #ddd; display:flex; align-items:center; justify-content:center;">
                                   <span style="color: #333;">Contenido de video en inglés no disponible.</span>
                                </div>`;
                       }
                    } else if (type === 'audio') {
                        audioLangOptions.classList.remove('visible');
                        audioPlaceholder.classList.add('visible');
                        audioPlaceholder.innerHTML = `
                            <p style="text-align:center; margin-bottom:15px; font-size:1.1rem; font-weight:bold;">Audio en ${lang === 'es' ? 'Español' : 'Inglés'}</p>
                            <audio controls style="width: 100%;">
                                <source src="#" type="audio/mpeg">
                                Tu navegador no soporta la etiqueta de audio.
                            </audio>
                            <p style="text-align:center; margin-top:15px; font-size:0.9rem; color:#555;">
                                <b>Nota:</b> Este es un marcador de posición. El archivo de audio debe estar disponible en el servidor.
                            </p>
                        `;
                    }
                });
            });

             // --- 3D Model Logic (Lazy Loading) ---
            const modelSection = document.getElementById('modelo-3d');
            let isModelInitialized = false;

            if (modelSection && typeof THREE !== 'undefined') {
                const observer = new IntersectionObserver((entries, obs) => {
                    if (entries[0].isIntersecting && !isModelInitialized) {
                        init3DModel();
                        isModelInitialized = true;
                        obs.unobserve(modelSection);
                    }
                }, { threshold: 0.1 });
                observer.observe(modelSection);
            }

            function init3DModel() {
                const container = document.getElementById('three-canvas-container');
                if (!container) return;

                // Scene, Camera, Renderer
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x333333);
                const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.set(0, 40, 150);
                const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;

                // Controls
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.minDistance = 70;
                controls.maxDistance = 300;
                controls.maxPolarAngle = Math.PI / 2 - 0.1;

                // Lighting (Sunset)
                scene.add(new THREE.AmbientLight(0x404040, 1.5));
                const dirLight = new THREE.DirectionalLight(0xffdcb2, 2.5);
                dirLight.position.set(-100, 80, -100);
                dirLight.castShadow = true;
                dirLight.shadow.mapSize.width = 2048;
                dirLight.shadow.mapSize.height = 2048;
                dirLight.shadow.camera.left = -150;
                dirLight.shadow.camera.right = 150;
                dirLight.shadow.camera.top = 150;
                dirLight.shadow.camera.bottom = -150;
                scene.add(dirLight);

                // Materials
                const beigeStoneMaterial = new THREE.MeshStandardMaterial({ color: 0xD3C5B8, roughness: 0.8 });
                const woodMaterial = new THREE.MeshStandardMaterial({ color: 0x4A2A1F, roughness: 0.7 });
                const goldMaterial = new THREE.MeshStandardMaterial({ color: 0xFFD700, metalness: 0.7, roughness: 0.3 });
                const roofMaterial = new THREE.MeshStandardMaterial({ color: 0x5C5C5C, roughness: 0.9 });
                
                // Cathedral Group
                const cathedral = new THREE.Group();
                
                // --- Main Structure ---
                const mainBody = new THREE.Mesh(new THREE.BoxGeometry(90, 40, 120), beigeStoneMaterial);
                mainBody.position.y = 20;
                mainBody.castShadow = true;
                mainBody.receiveShadow = true;
                cathedral.add(mainBody);
                
                // --- Facade ---
                const facade = new THREE.Mesh(new THREE.BoxGeometry(30, 45, 5), beigeStoneMaterial);
                facade.position.set(0, 22.5, 62.5);
                facade.castShadow = true;
                cathedral.add(facade);
                const door = new THREE.Mesh(new THREE.BoxGeometry(10, 18, 2), woodMaterial);
                door.position.set(0, 9, 65.5);
                cathedral.add(door);
                const goldDetail = new THREE.Mesh(new THREE.PlaneGeometry(5,5), goldMaterial);
                goldDetail.position.set(0, 9, 66.6);
                cathedral.add(goldDetail);

                // --- Towers ---
                function createTower(x) {
                    const group = new THREE.Group();
                    const base = new THREE.Mesh(new THREE.BoxGeometry(20, 50, 20), beigeStoneMaterial);
                    base.position.y = 25;
                    group.add(base);
                    const belfry = new THREE.Mesh(new THREE.CylinderGeometry(8, 8, 15, 8), beigeStoneMaterial);
                    belfry.position.y = 57.5;
                    group.add(belfry);
                    const dome = new THREE.Mesh(new THREE.SphereGeometry(8, 8, 6, 0, Math.PI * 2, 0, Math.PI / 2), roofMaterial);
                    dome.position.y = 65;
                    group.add(dome);
                    const cross = new THREE.Mesh(new THREE.BoxGeometry(1, 5, 1), goldMaterial);
                    cross.position.y = 74;
                    group.add(cross);
                    group.position.x = x;
                    group.position.z = 50;
                    
                    group.traverse(function(node) {
                        if (node.isMesh) {
                            node.castShadow = true;
                            node.receiveShadow = true;
                        }
                    });

                    return group;
                }
                cathedral.add(createTower(-35));
                cathedral.add(createTower(35));
                
                // --- Environment ---
                const ground = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), new THREE.MeshStandardMaterial({ color: 0x8D8780, roughness: 1 }));
                ground.rotation.x = -Math.PI / 2;
                ground.receiveShadow = true;
                scene.add(ground);
                
                function createPalm(x, z) {
                    const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.8, 15, 8), woodMaterial);
                    trunk.position.set(x, 7.5, z);
                    const leaves = new THREE.Mesh(new THREE.ConeGeometry(5, 10, 8), new THREE.MeshStandardMaterial({color: 0x2E8B57}));
                    leaves.position.set(x, 17.5, z);
                    trunk.castShadow = true;
                    scene.add(trunk);
                    scene.add(leaves);
                }
                createPalm(55, 80); createPalm(-55, 80); createPalm(65, 40); createPalm(-65, 40);

                scene.add(cathedral);

                // Handle window resize
                window.addEventListener('resize', () => {
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeight);
                });

                function animate() {
                    requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                }
                animate();
            }
            
            // --- Scroll Reveal Animations (iOS-like) ---
            if (typeof ScrollReveal !== 'undefined') {
                const sr = ScrollReveal({
                    distance: '15px',
                    duration: 500,
                    delay: 0,
                    easing: 'cubic-bezier(0.5, 0, 0, 1)',
                    reset: false,
                    useDelay: 'always',
                    viewFactor: 0.2,
                });

                sr.reveal('.section-title', { delay: 0 });
                sr.reveal('.gallery-item', { interval: 20 });
                sr.reveal('.timeline-container', { interval: 40 });
                sr.reveal('.detail-item', { interval: 20, origin: 'bottom' });
                sr.reveal('#modelo-3d .section-description, #three-canvas-container', { origin: 'bottom' });
                sr.reveal('#guia-multimedia .section-description, #guia-multimedia .media-controls', { origin: 'bottom', interval: 30 });
                sr.reveal('.map-text', { origin: 'left' });
                sr.reveal('.map-embed', { origin: 'right', delay: 40 });
            }
        });
    </script>
</body>
</html>
